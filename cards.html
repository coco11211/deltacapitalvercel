<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Cards &mdash; Delta Capital</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
  <style>
    :root {
      --serif: 'Cormorant Garamond', 'Georgia', serif;
      --mono:  'JetBrains Mono', 'Fira Code', monospace;
      --bg:    #080808;
      --white: #f4f4f4;
      --dim:   rgba(255,255,255,0.45);
      --faint: rgba(255,255,255,0.18);
      --line:  rgba(255,255,255,0.06);
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    html { scroll-behavior:smooth; }

    body {
      font-family: var(--serif);
      background: var(--bg);
      color: var(--white);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    /* ── Header ── */
    .page-header {
      text-align:center; padding:80px 20px 40px;
      opacity:0; transform:translateY(16px);
      animation:fadeUp .9s .2s forwards;
    }
    .page-header .delta {
      font-size:2.2rem; font-weight:300;
      color:rgba(255,255,255,0.2); margin-bottom:14px;
    }
    .page-header h1 {
      font-weight:300; font-size:clamp(1.6rem,3.5vw,2.4rem);
      letter-spacing:.05em; color:rgba(255,255,255,0.85);
    }
    .page-header p {
      font-family:var(--mono); font-size:.6rem;
      color:rgba(255,255,255,0.25); text-transform:uppercase;
      letter-spacing:.18em; margin-top:10px;
    }

    /* ── Grid ── */
    .cards-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(420px,1fr));
      max-width:1000px; margin:20px auto 100px; padding:0 40px;
    }
    @media(max-width:900px){ .cards-grid{ grid-template-columns:1fr; max-width:480px; } }
    @media(max-width:500px){ .cards-grid{ padding:0 16px; } }

    /* ── Wrap ── */
    .card-wrap {
      perspective:900px; padding:44px 20px;
      opacity:0; transform:translateY(32px);
    }
    .card-wrap.visible { animation:fadeUp .7s forwards; }
    .card-wrap:nth-child(1).visible { animation-delay:.08s; }
    .card-wrap:nth-child(2).visible { animation-delay:.20s; }
    .card-wrap:nth-child(3).visible { animation-delay:.32s; }
    .card-wrap:nth-child(4).visible { animation-delay:.44s; }

    /* Idle float — each card offset */
    .card-scene { width:100%; }
    .card-wrap:nth-child(1) .card-scene { animation:cardFloat 4.0s ease-in-out infinite  0.0s; }
    .card-wrap:nth-child(2) .card-scene { animation:cardFloat 4.4s ease-in-out infinite -1.5s; }
    .card-wrap:nth-child(3) .card-scene { animation:cardFloat 3.8s ease-in-out infinite -0.8s; }
    .card-wrap:nth-child(4) .card-scene { animation:cardFloat 4.2s ease-in-out infinite -2.2s; }
    .card-wrap:hover .card-scene { animation-play-state:paused; }
    @keyframes cardFloat {
      0%,100%{ transform:translateY(0); }
      50%     { transform:translateY(-7px); }
    }

    /* ── Flip container ── */
    .card-flip {
      width:100%; max-width:440px; aspect-ratio:3.5/2;
      margin:0 auto; position:relative;
      transform-style:preserve-3d;
      cursor:pointer; will-change:transform,filter;
      /* transition only used when flipping, spring handles tilt */
    }
    .card-flip.flipped { transform:rotateY(180deg) !important; transition:transform .75s cubic-bezier(.4,0,.2,1); }

    .card-face {
      position:absolute; inset:0;
      backface-visibility:hidden;
      border-radius:10px; overflow:hidden;
    }

    .card-hint {
      text-align:center; margin-top:12px;
      font-family:var(--mono); font-size:.5rem;
      text-transform:uppercase; letter-spacing:.15em;
      color:rgba(255,255,255,0.15); opacity:0; transition:opacity .3s;
    }
    .card-wrap:hover .card-hint { opacity:1; }

    /* ══ FRONT ══ */
    .card-front {
      background: var(--bg);
      border: 1px solid rgba(255,255,255,0.07);
      display:flex; flex-direction:column;
      justify-content:space-between; padding:9% 8%;
      box-shadow: 0 2px 40px rgba(0,0,0,0.7);
    }

    /* Canvas — full bleed chart */
    .card-front canvas {
      position:absolute; inset:0; width:100%; height:100%;
      pointer-events:none; z-index:1;
    }

    /* Gradient vignette — clears the lower third for text legibility */
    .card-front::before {
      content:''; position:absolute; inset:0;
      background:linear-gradient(to top,
        rgba(8,8,8,.96) 0%,
        rgba(8,8,8,.7)  28%,
        rgba(8,8,8,.2)  55%,
        transparent     80%
      );
      z-index:2; pointer-events:none;
    }

    /* Subtle scan line */
    .card-front::after {
      content:''; position:absolute; left:0; right:0; top:0; height:1px;
      background:linear-gradient(90deg,
        transparent 0%, rgba(255,255,255,.07) 25%,
        rgba(255,255,255,.16) 50%, rgba(255,255,255,.07) 75%, transparent 100%);
      animation:scanLine 9s ease-in-out infinite;
      z-index:6; pointer-events:none;
    }
    .card-wrap:nth-child(2) .card-front::after { animation-delay:-3s; }
    .card-wrap:nth-child(3) .card-front::after { animation-delay:-6s; }
    .card-wrap:nth-child(4) .card-front::after { animation-delay:-1.5s; }
    @keyframes scanLine {
      0%  { top:0%;   opacity:0; }
      3%  { opacity:1; }
      95% { opacity:.5; }
      100%{ top:100%; opacity:0; }
    }

    /* Shimmer — mono white only */
    .card-front .shimmer {
      position:absolute; inset:0; pointer-events:none;
      opacity:0; transition:opacity .35s; z-index:5;
      background:radial-gradient(
        circle 160px at var(--mx,50%) var(--my,50%),
        rgba(255,255,255,.05) 0%, transparent 100%
      );
    }
    .card-flip:hover .shimmer { opacity:1; }

    /* Top row */
    .card-front .top-row {
      display:flex; justify-content:space-between; align-items:flex-start;
      position:relative; z-index:8;
    }
    .card-front .delta-mark {
      font-size:clamp(1.3rem,2.8vw,1.7rem); font-weight:300; line-height:1;
      color:rgba(255,255,255,.7);
      will-change:transform;
    }
    .card-front .corner-accent {
      width:18px; height:18px; position:relative; will-change:transform;
    }
    .card-front .corner-accent::before,
    .card-front .corner-accent::after {
      content:''; position:absolute;
      background:rgba(255,255,255,.2); transition:background .4s;
    }
    .card-flip:hover .corner-accent::before,
    .card-flip:hover .corner-accent::after { background:rgba(255,255,255,.4); }
    .card-front .corner-accent::before { top:0; right:0; width:18px; height:.5px; }
    .card-front .corner-accent::after  { top:0; right:0; width:.5px; height:18px; }

    /* Person */
    .card-front .person { position:relative; z-index:8; }
    .card-front .person-name {
      display:block; font-size:clamp(.95rem,2vw,1.15rem); font-weight:400;
      letter-spacing:.03em; color:rgba(255,255,255,.88);
      will-change:transform;
    }
    .card-front .person-title {
      display:block; font-family:var(--mono);
      font-size:clamp(.42rem,.9vw,.52rem); font-weight:300;
      letter-spacing:.16em; text-transform:uppercase;
      color:rgba(255,255,255,.3);
      opacity:0; transform:translateY(4px); transition:all .5s .15s;
      will-change:transform;
    }
    .card-wrap.visible .person-title { opacity:1; transform:translateY(0); }

    /* Bottom foil line */
    .card-front .foil-line {
      position:absolute; bottom:0; left:0; right:0; height:1px;
      background:linear-gradient(90deg,
        transparent, rgba(255,255,255,.06) 25%,
        rgba(255,255,255,.18) 50%, rgba(255,255,255,.06) 75%, transparent);
      z-index:8;
    }

    /* ══ BACK ══ */
    .card-back {
      background: #f5f5f5;
      background-image:
        linear-gradient(rgba(0,0,0,.018) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,0,0,.018) 1px, transparent 1px);
      background-size:20px 20px;
      color:#111;
      transform:rotateY(180deg);
      display:flex; flex-direction:column;
      justify-content:space-between; padding:10% 9%;
      border:1px solid #e8e8e8;
    }
    /* Shine sweep */
    .card-back::after {
      content:''; position:absolute; inset:0; border-radius:10px;
      background:linear-gradient(112deg,
        transparent 36%, rgba(255,255,255,.55) 50%, transparent 64%);
      transform:translateX(-200%);
      animation:backShine 8s ease-in-out infinite;
      pointer-events:none; z-index:2;
    }
    @keyframes backShine {
      0%,60%,100%{ transform:translateX(-200%); }
      45%         { transform:translateX(200%); }
    }

    .card-back .top-section {
      display:flex; justify-content:space-between; align-items:flex-start;
      position:relative; z-index:3;
    }
    .card-back .brand-delta { font-size:1rem; font-weight:300; opacity:.5; line-height:1; }
    .card-back .brand-name  {
      font-size:.5rem; font-weight:400; letter-spacing:.12em;
      text-transform:uppercase; opacity:.35; margin-top:2px;
    }
    .card-back .qr-box {
      width:40px; height:40px; border:1px solid #ddd;
      display:flex; align-items:center; justify-content:center;
      font-size:.9rem; color:#bbb;
      transition:border-color .3s, color .3s;
    }
    .card-flip:hover .qr-box { border-color:#999; color:#777; }

    .card-back .details {
      display:flex; flex-direction:column; gap:4px;
      position:relative; z-index:3;
    }
    .card-back .detail-divider { width:24px; height:.5px; background:#ccc; margin-bottom:4px; }
    .card-back .detail-line {
      font-family:var(--mono); font-size:clamp(.38rem,.85vw,.48rem);
      font-weight:300; letter-spacing:.06em; color:#888;
    }
    .card-back .detail-line.email { color:#222; font-weight:400; }

    .card-back .copy-btn {
      position:absolute; bottom:8%; right:8%;
      font-family:var(--mono); font-size:.42rem;
      text-transform:uppercase; letter-spacing:.1em;
      background:none; border:1px solid #ddd; color:#aaa;
      padding:4px 10px; cursor:pointer; border-radius:2px;
      transition:all .2s; z-index:3;
    }
    .card-back .copy-btn:hover  { border-color:#222; color:#222; }
    .card-back .copy-btn.copied { border-color:#4a4; color:#4a4; }

    /* ── Shared keyframes ── */
    @keyframes fadeUp { to{ opacity:1; transform:translateY(0) scale(1); } }
  </style>
</head>
<body>

  <div class="page-header">
    <div class="delta">&Delta;</div>
    <h1>Delta Capital</h1>
    <p>Digital Business Cards</p>
  </div>

  <div class="cards-grid">

    <div class="card-wrap" data-email="colewysopal@deltacapitaltrading.com">
      <div class="card-scene">
        <div class="card-flip" onclick="flipCard(this)">
          <div class="card-face card-front">
            <canvas></canvas>
            <div class="shimmer"></div>
            <div class="top-row">
              <div class="delta-mark">&Delta;</div>
              <div class="corner-accent"></div>
            </div>
            <div class="person">
              <span class="person-name">Cole Wysopal</span>
              <span class="person-title">Chief Executive Officer</span>
            </div>
            <div class="foil-line"></div>
          </div>
          <div class="card-face card-back">
            <div class="top-section">
              <div><div class="brand-delta">&Delta;</div><div class="brand-name">Delta Capital</div></div>
              <div class="qr-box">&Delta;</div>
            </div>
            <div class="details">
              <div class="detail-divider"></div>
              <span class="detail-line email">colewysopal@deltacapitaltrading.com</span>
              <span class="detail-line">deltacapitaltrading.com</span>
            </div>
            <button class="copy-btn" onclick="copyEmail(event,this)">Copy Email</button>
          </div>
        </div>
      </div>
      <div class="card-hint">hover &nbsp;/&nbsp; click to flip</div>
    </div>

    <div class="card-wrap" data-email="yonatanshichor@deltacapitaltrading.com">
      <div class="card-scene">
        <div class="card-flip" onclick="flipCard(this)">
          <div class="card-face card-front">
            <canvas></canvas>
            <div class="shimmer"></div>
            <div class="top-row">
              <div class="delta-mark">&Delta;</div>
              <div class="corner-accent"></div>
            </div>
            <div class="person">
              <span class="person-name">Yonatan Shichor</span>
              <span class="person-title">Chief Financial Officer</span>
            </div>
            <div class="foil-line"></div>
          </div>
          <div class="card-face card-back">
            <div class="top-section">
              <div><div class="brand-delta">&Delta;</div><div class="brand-name">Delta Capital</div></div>
              <div class="qr-box">&Delta;</div>
            </div>
            <div class="details">
              <div class="detail-divider"></div>
              <span class="detail-line email">yonatanshichor@deltacapitaltrading.com</span>
              <span class="detail-line">deltacapitaltrading.com</span>
            </div>
            <button class="copy-btn" onclick="copyEmail(event,this)">Copy Email</button>
          </div>
        </div>
      </div>
      <div class="card-hint">hover &nbsp;/&nbsp; click to flip</div>
    </div>

    <div class="card-wrap" data-email="noahrubin@deltacapitaltrading.com">
      <div class="card-scene">
        <div class="card-flip" onclick="flipCard(this)">
          <div class="card-face card-front">
            <canvas></canvas>
            <div class="shimmer"></div>
            <div class="top-row">
              <div class="delta-mark">&Delta;</div>
              <div class="corner-accent"></div>
            </div>
            <div class="person">
              <span class="person-name">Noah Rubin</span>
              <span class="person-title">Chief Operating Officer</span>
            </div>
            <div class="foil-line"></div>
          </div>
          <div class="card-face card-back">
            <div class="top-section">
              <div><div class="brand-delta">&Delta;</div><div class="brand-name">Delta Capital</div></div>
              <div class="qr-box">&Delta;</div>
            </div>
            <div class="details">
              <div class="detail-divider"></div>
              <span class="detail-line email">noahrubin@deltacapitaltrading.com</span>
              <span class="detail-line">deltacapitaltrading.com</span>
            </div>
            <button class="copy-btn" onclick="copyEmail(event,this)">Copy Email</button>
          </div>
        </div>
      </div>
      <div class="card-hint">hover &nbsp;/&nbsp; click to flip</div>
    </div>

    <div class="card-wrap" data-email="ethanlopezlevy@deltacapital.com">
      <div class="card-scene">
        <div class="card-flip" onclick="flipCard(this)">
          <div class="card-face card-front">
            <canvas></canvas>
            <div class="shimmer"></div>
            <div class="top-row">
              <div class="delta-mark">&Delta;</div>
              <div class="corner-accent"></div>
            </div>
            <div class="person">
              <span class="person-name">Ethan Lopez Levy</span>
              <span class="person-title">Chief Administrative Officer</span>
            </div>
            <div class="foil-line"></div>
          </div>
          <div class="card-face card-back">
            <div class="top-section">
              <div><div class="brand-delta">&Delta;</div><div class="brand-name">Delta Capital</div></div>
              <div class="qr-box">&Delta;</div>
            </div>
            <div class="details">
              <div class="detail-divider"></div>
              <span class="detail-line email">ethanlopezlevy@deltacapital.com</span>
              <span class="detail-line">deltacapitaltrading.com</span>
            </div>
            <button class="copy-btn" onclick="copyEmail(event,this)">Copy Email</button>
          </div>
        </div>
      </div>
      <div class="card-hint">hover &nbsp;/&nbsp; click to flip</div>
    </div>

  </div>

<script>
(function () {
  'use strict';

  /* ══ FLIP ══ */
  window.flipCard = function (el) { el.classList.toggle('flipped'); };

  /* ══ COPY ══ */
  window.copyEmail = function (e, btn) {
    e.stopPropagation();
    var email = btn.closest('.card-wrap').getAttribute('data-email');
    navigator.clipboard.writeText(email).then(function () {
      btn.textContent = 'Copied'; btn.classList.add('copied');
      setTimeout(function () { btn.textContent = 'Copy Email'; btn.classList.remove('copied'); }, 2000);
    });
  };

  /* ══ SCROLL REVEAL ══ */
  var obs = new IntersectionObserver(function (ents) {
    ents.forEach(function (e) { if (e.isIntersecting) e.target.classList.add('visible'); });
  }, { threshold: 0.12 });
  document.querySelectorAll('.card-wrap').forEach(function (w) { obs.observe(w); });

  /* ══ SPRING TILT + PARALLAX ══ */
  document.querySelectorAll('.card-flip').forEach(function (card) {
    var shimmer = card.querySelector('.shimmer');
    var canvas  = card.querySelector('canvas');
    var dmark   = card.querySelector('.delta-mark');
    var pname   = card.querySelector('.person-name');
    var ptitle  = card.querySelector('.person-title');
    var corner  = card.querySelector('.corner-accent');

    var tx = 0, ty = 0, vx = 0, vy = 0, tX = 0, tY = 0, over = false;

    (function tick() {
      var k = over ? 0.09 : 0.06, d = 0.74;
      vx += (tX - tx) * k; vy += (tY - ty) * k;
      vx *= d; vy *= d; tx += vx; ty += vy;

      if (!card.classList.contains('flipped')) {
        card.style.transform = 'rotateX(' + tx.toFixed(2) + 'deg) rotateY(' + ty.toFixed(2) + 'deg)';
      }

      /* Drop-shadow shifts with tilt direction */
      var sx = (ty * 1.4).toFixed(1), sy = (-tx * 1.4).toFixed(1);
      card.style.filter = 'drop-shadow(' + sx + 'px ' + sy + 'px 32px rgba(0,0,0,.8))';

      /* Parallax layers */
      if (over) {
        if (dmark)  dmark.style.transform  = 'translate(' + (ty*1.4).toFixed(1) + 'px,' + (-tx*1.4).toFixed(1) + 'px)';
        if (pname)  pname.style.transform  = 'translate(' + (ty*0.7).toFixed(1) + 'px,' + (-tx*0.7).toFixed(1) + 'px)';
        if (ptitle) ptitle.style.transform = 'translate(' + (ty*0.3).toFixed(1) + 'px,' + (-tx*0.3).toFixed(1) + 'px)';
        if (corner) corner.style.transform = 'translate(' + (ty*1.1).toFixed(1) + 'px,' + (-tx*1.1).toFixed(1) + 'px)';
      }
      requestAnimationFrame(tick);
    })();

    card.addEventListener('mouseenter', function () { over = true; });

    card.addEventListener('mousemove', function (e) {
      var r = card.getBoundingClientRect();
      var x = (e.clientX - r.left) / r.width;
      var y = (e.clientY - r.top)  / r.height;
      tX = (y - 0.5) * -12;
      tY = (x - 0.5) *  12;
      shimmer.style.setProperty('--mx', (x * 100) + '%');
      shimmer.style.setProperty('--my', (y * 100) + '%');
      if (canvas) { canvas._mx = e.clientX - r.left; canvas._my = e.clientY - r.top; }
    });

    card.addEventListener('mouseleave', function () {
      over = false; tX = 0; tY = 0;
      if (canvas) { canvas._mx = null; canvas._my = null; }
      [dmark, pname, ptitle, corner].forEach(function (el) { if (el) el.style.transform = ''; });
    });
  });

  /* ══ GYROSCOPE ══ */
  if (typeof DeviceOrientationEvent !== 'undefined') {
    window.addEventListener('deviceorientation', function (e) {
      if (e.beta === null) return;
      var roll  = Math.max(-1, Math.min(1, e.gamma / 25));
      var pitch = Math.max(-1, Math.min(1, (e.beta - 45) / 25));
      document.querySelectorAll('.card-flip:not(:hover)').forEach(function (card) {
        card._gyroX = pitch * -10;
        card._gyroY = roll  *  10;
      });
    });
  }

  /* ══ MARKET CHART CANVAS ══ */
  document.querySelectorAll('.card-front canvas').forEach(function (canvas, idx) {
    var ctx = canvas.getContext('2d');
    var dpr = window.devicePixelRatio || 1;
    var w = 0, h = 0, animId;

    /* ── Price simulation ── */
    var HISTORY = 220;
    var prices = [], volumes = [];
    var price = 50 + (Math.random() - 0.5) * 12;
    var vel   = 0;

    /* Seed with history, each card a different "instrument" */
    var seed = idx * 137.5 + 42;
    function rng() { seed = (seed * 1664525 + 1013904223) & 0xffffffff; return (seed >>> 0) / 0xffffffff; }

    for (var i = 0; i < HISTORY; i++) {
      vel += (rng() - 0.5) * 0.9;
      vel *= 0.88;
      vel += (50 - price) * 0.003;  /* mean reversion */
      price += vel;
      price = Math.max(10, Math.min(90, price));
      prices.push(price);
      volumes.push(0.3 + rng() * 0.7);
    }

    var frame = 0;

    function resize() {
      var rect = canvas.parentElement.getBoundingClientRect();
      w = rect.width; h = rect.height;
      canvas.width  = w * dpr; canvas.height = h * dpr;
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function drawChart() {
      ctx.clearRect(0, 0, w, h);

      /* Add a new tick every 2 frames */
      if (frame++ % 2 === 0) {
        vel += (Math.random() - 0.5) * 0.7;
        vel *= 0.90;
        vel += (50 - price) * 0.002;
        price += vel;
        price = Math.max(10, Math.min(90, price));
        prices.push(price);
        volumes.push(0.3 + Math.random() * 0.7);
        if (prices.length > HISTORY) { prices.shift(); volumes.shift(); }
      }

      /* Visible window */
      var N   = prices.length;
      var VIS = Math.min(N, 110);           /* bars shown */
      var vis = prices.slice(N - VIS);
      var vol = volumes.slice(N - VIS);

      var pMin = Infinity, pMax = -Infinity;
      for (var i = 0; i < vis.length; i++) {
        if (vis[i] < pMin) pMin = vis[i];
        if (vis[i] > pMax) pMax = vis[i];
      }
      var pad   = (pMax - pMin) * 0.25 || 1;
      pMin -= pad; pMax += pad;
      var pRange = pMax - pMin;

      /* Layout */
      var chartTop  = h * 0.08;
      var chartBot  = h * 0.72;
      var chartH    = chartBot - chartTop;
      var volTop    = h * 0.76;
      var volBot    = h * 0.92;
      var volH      = volBot - volTop;

      function py(p) { return chartBot - ((p - pMin) / pRange) * chartH; }

      /* ── Grid ── */
      ctx.strokeStyle = 'rgba(255,255,255,0.04)';
      ctx.lineWidth   = 0.5;
      for (var row = 0; row <= 4; row++) {
        var gy = chartTop + (row / 4) * chartH;
        ctx.beginPath(); ctx.moveTo(0, gy); ctx.lineTo(w, gy); ctx.stroke();
      }
      for (var col = 1; col <= 5; col++) {
        var gx = (col / 6) * w;
        ctx.beginPath(); ctx.moveTo(gx, chartTop); ctx.lineTo(gx, chartBot); ctx.stroke();
      }

      /* ── Volume bars (very faint) ── */
      var bw = w / VIS;
      ctx.fillStyle = 'rgba(255,255,255,0.055)';
      for (var i = 0; i < vis.length; i++) {
        var bx = i * bw;
        var bh = vol[i] * volH;
        ctx.fillRect(bx + bw * 0.1, volBot - bh, bw * 0.8, bh);
      }

      /* ── Separator between chart and volume ── */
      ctx.strokeStyle = 'rgba(255,255,255,0.05)';
      ctx.lineWidth = 0.5;
      ctx.beginPath(); ctx.moveTo(0, volTop - 2); ctx.lineTo(w, volTop - 2); ctx.stroke();

      /* ── Area fill ── */
      ctx.beginPath();
      for (var i = 0; i < vis.length; i++) {
        var px_ = (i / (vis.length - 1)) * w;
        var py_ = py(vis[i]);
        if (i === 0) ctx.moveTo(px_, py_); else ctx.lineTo(px_, py_);
      }
      ctx.lineTo(w, chartBot); ctx.lineTo(0, chartBot); ctx.closePath();
      var areaGrad = ctx.createLinearGradient(0, chartTop, 0, chartBot);
      areaGrad.addColorStop(0,   'rgba(255,255,255,0.08)');
      areaGrad.addColorStop(0.6, 'rgba(255,255,255,0.02)');
      areaGrad.addColorStop(1,   'rgba(255,255,255,0)');
      ctx.fillStyle = areaGrad;
      ctx.fill();

      /* ── Price line ── */
      ctx.beginPath();
      for (var i = 0; i < vis.length; i++) {
        var px_ = (i / (vis.length - 1)) * w;
        var py_ = py(vis[i]);
        if (i === 0) ctx.moveTo(px_, py_); else ctx.lineTo(px_, py_);
      }
      ctx.strokeStyle = 'rgba(255,255,255,0.5)';
      ctx.lineWidth   = 1;
      ctx.lineJoin    = 'round';
      ctx.stroke();

      /* ── Current price dot ── */
      var lastY = py(vis[vis.length - 1]);
      ctx.beginPath(); ctx.arc(w, lastY, 2.5, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,255,255,0.9)'; ctx.fill();
      ctx.beginPath(); ctx.arc(w, lastY, 5, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,255,255,0.12)'; ctx.fill();

      /* ── Mouse crosshair ── */
      var mx = canvas._mx, my = canvas._my;
      if (mx != null && mx >= 0 && mx <= w && my >= chartTop && my <= chartBot) {
        ctx.strokeStyle = 'rgba(255,255,255,0.12)';
        ctx.lineWidth = 0.5;
        ctx.setLineDash([4, 5]);
        ctx.beginPath(); ctx.moveTo(mx, chartTop); ctx.lineTo(mx, chartBot); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, my); ctx.lineTo(w, my); ctx.stroke();
        ctx.setLineDash([]);
        /* Intersection dot */
        var dataIdx = Math.round((mx / w) * (vis.length - 1));
        dataIdx = Math.max(0, Math.min(vis.length - 1, dataIdx));
        var crossY = py(vis[dataIdx]);
        var crossX = (dataIdx / (vis.length - 1)) * w;
        ctx.beginPath(); ctx.arc(crossX, crossY, 3, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255,255,255,0.7)'; ctx.fill();
      }

      animId = requestAnimationFrame(drawChart);
    }

    /* Start only when visible */
    var active = false;
    var visObs = new IntersectionObserver(function (ents) {
      ents.forEach(function (e) {
        if (e.isIntersecting && !active) { active = true; resize(); drawChart(); }
        else if (!e.isIntersecting && active) { active = false; cancelAnimationFrame(animId); }
      });
    }, { threshold: 0.05 });

    function init() {
      resize();
      visObs.observe(canvas.closest('.card-wrap'));
      window.addEventListener('resize', function () { resize(); });
    }

    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
    else init();
  });

})();
</script>
</body>
</html>
